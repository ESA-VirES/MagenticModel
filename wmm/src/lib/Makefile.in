# paths set by autoconf
prefix=@prefix@
exec_prefix=@exec_prefix@
PACKAGE_TARNAME=@PACKAGE_TARNAME@
CC=@CC@
RM=rm -fv
CFLAGS=@CFLAGS@
LFLAGS=-shared -lm
INSTAL_LIB_DIR=@libdir@
INSTAL_INC_DIR=@includedir@/${PACKAGE_TARNAME}
INSTAL_DOC_DIR=@docdir@
TARGET=libgeomag.so
HDR=GeomagnetismHeader.h EGM9615.h
OBJ=GeomagnetismLibrary.o
DOC=Changelog.txt WMM_README.txt README

%.o: %.c $(HDR)
	$(CC) -c -o $@ $< $(CFLAGS)

all: build

build: $(TARGET)

install: $(TARGET) $(HDR) $(DOC)
	mkdir -p $(INSTAL_LIB_DIR)
	install -c -m 0755 $(TARGET) $(INSTAL_LIB_DIR)
	[ "$(USER)" != "root" ] || ldconfig
	mkdir -p $(INSTAL_INC_DIR)
	install -c -m 0664 $(HDR) $(INSTAL_INC_DIR)
	mkdir -p $(INSTAL_DOC_DIR)
	install -c -m 0664 $(DOC) $(INSTAL_DOC_DIR)

clean:
	$(RM) $(OBJ) $(TARGET)

$(TARGET): $(OBJ) 
	$(CC) -o $(TARGET) $(OBJ) $(LFLAGS)
